!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var r,i,s,o;function l(e,t,n){const r=n.value;return{configurable:!0,get(){return r.bind(this)}}}n.r(t),n.d(t,"App",(function(){return h})),(r||(r={})).Component=class{constructor(e,t,n,r){this.templateElement=document.getElementById(e),this.hostElement=document.getElementById(t);const i=document.importNode(this.templateElement.content,!0);this.element=i.firstElementChild,r&&(this.element.id=r),this.attach(n)}attach(e){this.hostElement.insertAdjacentElement(e?"afterbegin":"beforeend",this.element)}},function(e){let t;!function(e){e[e.active=0]="active",e[e.finished=1]="finished"}(t=e.ProjectStatus||(e.ProjectStatus={}));e.Project=class{constructor(e,t,n,r,i){this.id=e,this.title=t,this.description=n,this.people=r,this.status=i}}}(i||(i={})),function(e){class t{constructor(){this.projects=[],this.listeners=[]}static getInstance(){return this.instance?this.instance:this.instance=new t}addListener(e){this.listeners.push(e)}addProject(e,t,n){const r=new i.Project(Math.random().toString(),e,t,n,i.ProjectStatus.active);this.projects.push(r),this.updateListeners()}moveProject(e,t){const n=this.projects.find(t=>t.id===e);n&&n.status!==t&&(n.status=t),this.updateListeners()}updateListeners(){for(const e of this.listeners)e(this.projects.slice())}}e.ProjectState=t,e.projectState=t.getInstance()}(s||(s={})),function(e){e.Validate=function(e){let t=!0;return e.required&&(t=t&&0!==e.value.toString().trim().length),null!=e.minLength&&"string"==typeof e.value&&(t=t&&e.value.length>e.minLength),null!=e.maxLength&&"string"==typeof e.value&&(t=t&&e.value.length<e.maxLength),null!=e.min&&"number"==typeof e.value&&(t=t&&e.value>e.min),null!=e.max&&"number"==typeof e.value&&(t=t&&e.value<e.max),t}}(o||(o={}));var a,c=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};!function(e){class t extends r.Component{constructor(){super("project-input","app",!0,"user-input"),this.titleInputElement=this.element.querySelector("#title"),this.descriptionInputElement=this.element.querySelector("#description"),this.peopleInputElement=this.element.querySelector("#people"),this.configure(),this.renderContent()}gatherUserInput(){const e=this.titleInputElement.value,t=this.descriptionInputElement.value,n=this.peopleInputElement.value,r={value:e,required:!0},i={value:t,required:!0,minLength:5},s={value:e,required:!0,min:1,max:5};if(o.Validate(r)&&o.Validate(i)&&o.Validate(s))return[e,t,+n];alert("Input is incorrect! Try again")}clearingFields(){this.titleInputElement.value="",this.descriptionInputElement.value="",this.peopleInputElement.value=""}submitHandler(e){e.preventDefault();const t=this.gatherUserInput();if(Array.isArray(t)){const[e,n,r]=t;s.projectState.addProject(e,n,r),this.clearingFields()}}configure(){this.element.addEventListener("submit",this.submitHandler)}renderContent(){}}c([l],t.prototype,"submitHandler",null),e.ProjectInput=t}(a||(a={}));var u,d=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};!function(e){class t extends r.Component{constructor(e,t){super("single-project",e,!1,t.id),this.project=t,this.configure(),this.renderContent()}get persons(){return 1===this.project.people?"1 Person":this.project.people+" People"}dragStartHandler(e){e.dataTransfer.setData("text/plain",this.project.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){console.log("drag event ended")}configure(){this.element.addEventListener("dragstart",this.dragStartHandler),this.element.addEventListener("dragend",this.dragEndHandler)}renderContent(){this.element.querySelector("h2").textContent=this.project.title,this.element.querySelector("h3").textContent=this.persons+" assigned",this.element.querySelector("p").textContent="Project description: "+this.project.description}}d([l],t.prototype,"dragStartHandler",null),e.ProjectItem=t}(u||(u={}));var p,h,f,m=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};!function(e){class t extends r.Component{constructor(e){super("project-list","app",!1,e+"-projects"),this.type=e,this.assignedProjects=[],this.configure(),this.renderContent()}dragOverHandler(e){if(e.dataTransfer&&"text/plain"===e.dataTransfer.types[0]){e.preventDefault(),this.element.querySelector("ul").classList.add("droppable")}}dropHandler(e){const t=e.dataTransfer.getData("text/plain");s.projectState.moveProject(t,"active"===this.type?i.ProjectStatus.active:i.ProjectStatus.finished)}dragLeaveHandler(e){this.element.querySelector("ul").classList.remove("droppable")}renderProjects(){document.getElementById(this.type+"-projects-list").innerHTML="";for(const e of this.assignedProjects)new u.ProjectItem(this.element.querySelector("ul").id,e)}renderContent(){const e=this.type+"-projects-list";this.element.querySelector("ul").id=e,this.element.querySelector("h2").textContent=this.type.toUpperCase()+" PROJECTS"}configure(){this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),this.element.addEventListener("drop",this.dropHandler),s.projectState.addListener(e=>{const t=e.filter(e=>"active"===this.type?e.status===i.ProjectStatus.active:e.status===i.ProjectStatus.finished);this.assignedProjects=t,this.renderProjects()})}}m([l],t.prototype,"dragOverHandler",null),m([l],t.prototype,"dropHandler",null),m([l],t.prototype,"dragLeaveHandler",null),e.ProjectList=t}(p||(p={})),(f=h||(h={})).proj=new a.ProjectInput,f.activeProjList=new p.ProjectList("active"),f.finishedProjList=new p.ProjectList("finished")}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbXBvbmVudHMvQ29tcG9uZW50LnRzIiwid2VicGFjazovLy8uL3NyYy9jb21wb25lbnRzL1Byb2plY3QudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3N0YXRlL1Byb2plY3RTdGF0ZS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdXRpbC9WYWxpZGF0YWJsZS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZGVjb3JhdG9ycy9hdXRvYmluZC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvY29tcG9uZW50cy9Qcm9qZWN0SW5wdXQudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbXBvbmVudHMvUHJvamVjdEl0ZW0udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbXBvbmVudHMvUHJvamVjdExpc3QudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FwcC50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIkNvbXBvbmVudCIsIlByb2plY3QiLCJWYWxpdGFkYWJsZSIsImF1dG9iaW5kIiwiX3RhcmdldCIsIl9tZXRob2ROYW1lIiwiZGVzY3JpcHRvciIsIm9yaWdpbmFsTWV0aG9kIiwiY29uZmlndXJhYmxlIiwidGhpcyIsInRlbXBsYXRlSWQiLCJob3N0RWxlbWVudElkIiwiaW5zZXJ0QXRTdGFydCIsIm5ld0VsZW1lbnRJZCIsInRlbXBsYXRlRWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJob3N0RWxlbWVudCIsImltcG9ydGVkTm9kZSIsImltcG9ydE5vZGUiLCJjb250ZW50IiwiZWxlbWVudCIsImZpcnN0RWxlbWVudENoaWxkIiwiaWQiLCJhdHRhY2giLCJpbnNlcnRXaGVyZSIsImluc2VydEFkamFjZW50RWxlbWVudCIsIlByb2plY3RTdGF0dXMiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwicGVvcGxlIiwic3RhdHVzIiwiUHJvamVjdFN0YXRlIiwicHJvamVjdHMiLCJsaXN0ZW5lcnMiLCJpbnN0YW5jZSIsImxpc3RlbmVyRm4iLCJwdXNoIiwibnVtT2ZQZW9wbGUiLCJuZXdQcm9qZWN0IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwiYWN0aXZlIiwidXBkYXRlTGlzdGVuZXJzIiwicHJvamVjdElkIiwibmV3U3RhdHVzIiwicHJvamVjdCIsImZpbmQiLCJwcmoiLCJzbGljZSIsInByb2plY3RTdGF0ZSIsImdldEluc3RhbmNlIiwiVmFsaWRhdGUiLCJ2YWxpZGF0ZUlucHV0IiwiaXNWYWxpZCIsInJlcXVpcmVkIiwidHJpbSIsImxlbmd0aCIsIm1pbkxlbmd0aCIsIm1heExlbmd0aCIsIm1pbiIsIm1heCIsIlByb2plY3RJbnB1dCIsInN1cGVyIiwidGl0bGVJbnB1dEVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQiLCJwZW9wbGVJbnB1dEVsZW1lbnQiLCJjb25maWd1cmUiLCJyZW5kZXJDb250ZW50IiwiaW5wdXRUaXRsZSIsImlucHV0RGVzY3JpcHRpb24iLCJpbnB1dFBlb3BsZSIsInRpdGxlVmFsaWRhdGFibGUiLCJkZXNjcmlwdGlvblZhbGlkYXRhYmxlIiwicGVvcGxlVmFsaWRhdGFibGUiLCJhbGVydCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJ1c2VySW5wdXQiLCJnYXRoZXJVc2VySW5wdXQiLCJBcnJheSIsImlzQXJyYXkiLCJudW1iZXIiLCJhZGRQcm9qZWN0IiwiY2xlYXJpbmdGaWVsZHMiLCJhZGRFdmVudExpc3RlbmVyIiwic3VibWl0SGFuZGxlciIsIlByb2plY3RJdGVtIiwiaG9zdElkIiwiZGF0YVRyYW5zZmVyIiwic2V0RGF0YSIsImVmZmVjdEFsbG93ZWQiLCJfZXZlbnQiLCJjb25zb2xlIiwibG9nIiwiZHJhZ1N0YXJ0SGFuZGxlciIsImRyYWdFbmRIYW5kbGVyIiwidGV4dENvbnRlbnQiLCJwZXJzb25zIiwiQXBwIiwiUHJvamVjdExpc3QiLCJ0eXBlIiwiYXNzaWduZWRQcm9qZWN0cyIsInR5cGVzIiwiY2xhc3NMaXN0IiwiYWRkIiwicHJvaklkIiwiZ2V0RGF0YSIsIm1vdmVQcm9qZWN0IiwiZmluaXNoZWQiLCJyZW1vdmUiLCJpbm5lckhUTUwiLCJwcmpJdGVtIiwibGlzdElkIiwidG9VcHBlckNhc2UiLCJkcmFnT3ZlckhhbmRsZXIiLCJkcmFnTGVhdmVIYW5kbGVyIiwiZHJvcEhhbmRsZXIiLCJhZGRMaXN0ZW5lciIsImZpbHRlcmVkUHJvamVjdHMiLCJmaWx0ZXIiLCJyZW5kZXJQcm9qZWN0cyIsInByb2oiLCJhY3RpdmVQcm9qTGlzdCIsImZpbmlzaGVkUHJvakxpc3QiXSwibWFwcGluZ3MiOiJhQUNFLElBQUlBLEVBQW1CLEdBR3ZCLFNBQVNDLEVBQW9CQyxHQUc1QixHQUFHRixFQUFpQkUsR0FDbkIsT0FBT0YsRUFBaUJFLEdBQVVDLFFBR25DLElBQUlDLEVBQVNKLEVBQWlCRSxHQUFZLENBQ3pDRyxFQUFHSCxFQUNISSxHQUFHLEVBQ0hILFFBQVMsSUFVVixPQU5BSSxFQUFRTCxHQUFVTSxLQUFLSixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTRixHQUcvREcsRUFBT0UsR0FBSSxFQUdKRixFQUFPRCxRQUtmRixFQUFvQlEsRUFBSUYsRUFHeEJOLEVBQW9CUyxFQUFJVixFQUd4QkMsRUFBb0JVLEVBQUksU0FBU1IsRUFBU1MsRUFBTUMs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YyxNQUFXLE1DSFhELEVBQUEsTUFBRyxLQUVGdUIsS0FBTyxJQUFJLEVBQWE3RCxhQUV4QixFQUFBOEQsZUFBaUIsSUFBSSxFQUFZdkIsWUFBWSxVQUM3QyxFQUFBd0IsaUJBQW1CLElBQUksRUFBWXhCLFlBQVkiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiZXhwb3J0IG1vZHVsZSBDb21wb25lbnQge1xuICAvL0NvbXBvbmVudCBCYXNlIENsYXNzLCB1c2luZyBnZW5lcmljcyB0byBlbnN1cmUgZmxleGliaWxpdHkgb2YgdGhlIHZhcmlhYmxlc1xuICBleHBvcnQgYWJzdHJhY3QgY2xhc3MgQ29tcG9uZW50PFxuICAgIFQgZXh0ZW5kcyBIVE1MRWxlbWVudCxcbiAgICBVIGV4dGVuZHMgSFRNTEVsZW1lbnRcbiAgPiB7XG4gICAgdGVtcGxhdGVFbGVtZW50OiBIVE1MVGVtcGxhdGVFbGVtZW50O1xuICAgIGhvc3RFbGVtZW50OiBUO1xuICAgIGVsZW1lbnQ6IFU7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgIHRlbXBsYXRlSWQ6IHN0cmluZyxcbiAgICAgIGhvc3RFbGVtZW50SWQ6IHN0cmluZyxcbiAgICAgIGluc2VydEF0U3RhcnQ6IGJvb2xlYW4sXG4gICAgICBuZXdFbGVtZW50SWQ/OiBzdHJpbmdcbiAgICApIHtcbiAgICAgIHRoaXMudGVtcGxhdGVFbGVtZW50ID0gPFxuICAgICAgICBIVE1MVGVtcGxhdGVFbGVtZW50IC8vc2VsZWN0aW5nIGVsZW1lbnRzXG4gICAgICA+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGVtcGxhdGVJZCkhO1xuICAgICAgdGhpcy5ob3N0RWxlbWVudCA9IDxUPmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGhvc3RFbGVtZW50SWQpITsgLy9nZXQgdGhlIHBpZWNlIG9mIGNvZGUgaW4gd2hpY2ggdGhlIHRlbXBsYXRlIHNob3VsZCBiZSBkaXNwbGF5ZWQgaW5cbiAgICAgIGNvbnN0IGltcG9ydGVkTm9kZSA9IGRvY3VtZW50LmltcG9ydE5vZGUoXG4gICAgICAgIC8vaW1wb3J0cyBhIG5vZGUgYW5kIHNldCB0aGUgSURcbiAgICAgICAgdGhpcy50ZW1wbGF0ZUVsZW1lbnQuY29udGVudCxcbiAgICAgICAgdHJ1ZVxuICAgICAgKTtcbiAgICAgIHRoaXMuZWxlbWVudCA9IDxVPmltcG9ydGVkTm9kZS5maXJzdEVsZW1lbnRDaGlsZDsgLy9pbXBvcnRzIHRoZSBlbGVtZW50XG4gICAgICBpZiAobmV3RWxlbWVudElkKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5pZCA9IG5ld0VsZW1lbnRJZDtcbiAgICAgIH1cbiAgICAgIHRoaXMuYXR0YWNoKGluc2VydEF0U3RhcnQpO1xuICAgIH1cbiAgICBwcml2YXRlIGF0dGFjaChpbnNlcnRXaGVyZTogYm9vbGVhbikge1xuICAgICAgdGhpcy5ob3N0RWxlbWVudC5pbnNlcnRBZGphY2VudEVsZW1lbnQoXG4gICAgICAgIGluc2VydFdoZXJlID8gXCJhZnRlcmJlZ2luXCIgOiBcImJlZm9yZWVuZFwiLFxuICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICk7XG4gICAgfVxuICAgIGFic3RyYWN0IGNvbmZpZ3VyZSgpOiB2b2lkO1xuICAgIGFic3RyYWN0IHJlbmRlckNvbnRlbnQoKTogdm9pZDtcbiAgfVxufVxuIiwiLy9wcm9qZWN0IHR5cGVcblxuZXhwb3J0IG1vZHVsZSBQcm9qZWN0IHtcbiAgZXhwb3J0IGVudW0gUHJvamVjdFN0YXR1cyB7XG4gICAgYWN0aXZlLFxuICAgIGZpbmlzaGVkLFxuICB9XG5cbiAgZXhwb3J0IGNsYXNzIFByb2plY3Qge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgcHVibGljIGlkOiBzdHJpbmcsXG4gICAgICBwdWJsaWMgdGl0bGU6IHN0cmluZyxcbiAgICAgIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nLFxuICAgICAgcHVibGljIHBlb3BsZTogbnVtYmVyLFxuICAgICAgcHVibGljIHN0YXR1czogUHJvamVjdFN0YXR1c1xuICAgICkge31cbiAgfVxufVxuIiwiaW1wb3J0IHsgUHJvamVjdCB9IGZyb20gXCIuLi9jb21wb25lbnRzL1Byb2plY3RcIjtcbmltcG9ydCB7IExpc3RlbmVyIH0gZnJvbSBcImxpc3RlbmVyXCI7XG5cbmV4cG9ydCBtb2R1bGUgUHJvamVjdFN0YXRlIHtcbiAgZXhwb3J0IGNsYXNzIFByb2plY3RTdGF0ZSB7XG4gICAgcHJpdmF0ZSBwcm9qZWN0czogUHJvamVjdC5Qcm9qZWN0W10gPSBbXTtcbiAgICBwcml2YXRlIGxpc3RlbmVyczogTGlzdGVuZXIuTGlzdGVuZXJbXSA9IFtdO1xuICAgIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBQcm9qZWN0U3RhdGU7XG5cbiAgICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge31cblxuICAgIHN0YXRpYyBnZXRJbnN0YW5jZSgpIHtcbiAgICAgIGlmICh0aGlzLmluc3RhbmNlKSByZXR1cm4gdGhpcy5pbnN0YW5jZTsgLy8gY2hlY2tzIGlmIGluc3RhbmNlIGV4aXN0c1xuICAgICAgcmV0dXJuICh0aGlzLmluc3RhbmNlID0gbmV3IFByb2plY3RTdGF0ZSgpKTsgLy8gaWYgbm90LCByZXR1cm5zIGEgbmV3IGluc3RhbmNlXG4gICAgfVxuXG4gICAgYWRkTGlzdGVuZXIobGlzdGVuZXJGbjogTGlzdGVuZXIuTGlzdGVuZXIpIHtcbiAgICAgIHRoaXMubGlzdGVuZXJzLnB1c2gobGlzdGVuZXJGbik7XG4gICAgfVxuXG4gICAgYWRkUHJvamVjdCh0aXRsZTogc3RyaW5nLCBkZXNjcmlwdGlvbjogc3RyaW5nLCBudW1PZlBlb3BsZTogbnVtYmVyKSB7XG4gICAgICBjb25zdCBuZXdQcm9qZWN0ID0gbmV3IFByb2plY3QuUHJvamVjdChcbiAgICAgICAgTWF0aC5yYW5kb20oKS50b1N0cmluZygpLFxuICAgICAgICB0aXRsZSxcbiAgICAgICAgZGVzY3JpcHRpb24sXG4gICAgICAgIG51bU9mUGVvcGxlLFxuICAgICAgICBQcm9qZWN0LlByb2plY3RTdGF0dXMuYWN0aXZlXG4gICAgICApO1xuICAgICAgdGhpcy5wcm9qZWN0cy5wdXNoKG5ld1Byb2plY3QpO1xuICAgICAgdGhpcy51cGRhdGVMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICBtb3ZlUHJvamVjdChwcm9qZWN0SWQ6IHN0cmluZywgbmV3U3RhdHVzOiBQcm9qZWN0LlByb2plY3RTdGF0dXMpIHtcbiAgICAgIGNvbnN0IHByb2plY3QgPSB0aGlzLnByb2plY3RzLmZpbmQoKHByaikgPT4gcHJqLmlkID09PSBwcm9qZWN0SWQpOyAvL2ZpbmQgbWV0aG9kIHJ1bnMgaW4gZXZlcnkgZWxlbWVudCBvZiB0aGUgYXJyYXlcbiAgICAgIGlmIChwcm9qZWN0ICYmIHByb2plY3Quc3RhdHVzICE9PSBuZXdTdGF0dXMpIHByb2plY3Quc3RhdHVzID0gbmV3U3RhdHVzO1xuICAgICAgdGhpcy51cGRhdGVMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHVwZGF0ZUxpc3RlbmVycygpIHtcbiAgICAgIGZvciAoY29uc3QgbGlzdGVuZXJGbiBvZiB0aGlzLmxpc3RlbmVycykge1xuICAgICAgICAvLyBsb29wIHRocm91Z2ggYWxsIGxpc3RlbmVyIGZ1bmN0aW9ucyB3aXRoIGEgZm9yIGxvb3BcbiAgICAgICAgbGlzdGVuZXJGbih0aGlzLnByb2plY3RzLnNsaWNlKCkpOyAvL3NsaWNlIHJldHVybnMgYSBjb3B5IG9mIHRoZSBhcnJheSwgbm90IHRoZSBvcmlnaW5hbCBvbmUuIEphdmFzY3JpcHQgaXMgcGFzcyBieSByZWZlcmVuY2Ugc28gaWYgeW91IHBhc3MgdGhlIGFycmF5IGl0c2VsZiB5b3UnZCBiZSBjaGFuZ2luZyB0aGUgb3JpZ2luYWwgdmFsdWVzXG4gICAgICB9XG4gICAgfVxuICB9XG4gIGV4cG9ydCBjb25zdCBwcm9qZWN0U3RhdGUgPSBQcm9qZWN0U3RhdGUuZ2V0SW5zdGFuY2UoKTsgLy8gaW5zdGFudGlhdGVzIHByb2plY3Qgc3RhdGUgc28geW91IGNhbiB1c2UgdGhpcyBhbnl3aGVyZSBpbiB0aGUgZmlsZSAtIGdsb2JhbCBjb25zdGFudFxufVxuIiwiLy9pbnB1dCB2YWxpZGF0aW9uIGludGVyZmFjZSAtIGNyZWF0ZXMgdGhlIHN0cnVjdHVyZSBvZiB0aGUgb2JqZWN0IHRoYXQgd2lsbFxuLy9iZSBwYXNzZWQgaW50byB0aGUgdmFsaWRhdGUgZnVuY3Rpb25cblxuLy8gaW1wb3J0IHsgVmFsaWRhdGVGdW5jdGlvbnMgfSBmcm9tIFwiVmFsaWRhdGVGdW5jdGlvbnNcIjtcblxuZXhwb3J0IG1vZHVsZSBWYWxpdGFkYWJsZSB7XG4gIGV4cG9ydCBpbnRlcmZhY2UgVmFsaWRhdGFibGUge1xuICAgIHZhbHVlOiBzdHJpbmcgfCBudW1iZXI7XG4gICAgcmVxdWlyZWQ/OiBib29sZWFuO1xuICAgIG1pbkxlbmd0aD86IG51bWJlcjtcbiAgICBtYXhMZW5ndGg/OiBudW1iZXI7XG4gICAgbWluPzogbnVtYmVyO1xuICAgIG1heD86IG51bWJlcjtcbiAgfVxuXG4gIC8vdmFsaWRhdGlvbiBmdW5jdGlvblxuICBleHBvcnQgZnVuY3Rpb24gVmFsaWRhdGUodmFsaWRhdGVJbnB1dDogVmFsaWRhdGFibGUpIHtcbiAgICAvL3dlIHNldCB0aGlzIHRvIGZhbHNlIGFzIHNvb24gYXMgYW55IHZhciBmYWlscyB0aGUgdGVzdFxuICAgIGxldCBpc1ZhbGlkID0gdHJ1ZTtcblxuICAgIGlmICh2YWxpZGF0ZUlucHV0LnJlcXVpcmVkKVxuICAgICAgLy9pZiB0aGUgcmVxdWlyZWQgdmFyIGlzIHNldCBhbmQgdHJ1ZSAobm90IHVuZGVmaW5lZCkgdGhlbiB2YWx1ZSBtdXN0IG5vdCBiZSBlbXB0eVxuICAgICAgLy9jaGVja3MgaWYgdmFsdWUgaXMgZW1wdHkgYWZ0ZXIgdHJpbW1pbmcgdGhlIHN0cmluZ1xuICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGVJbnB1dC52YWx1ZS50b1N0cmluZygpLnRyaW0oKS5sZW5ndGggIT09IDA7IC8vaWYgbWluTGVuZ3RoIGlzIHNldCB0aGVuIGl0IHNob3VsZCBoYXZlIGEgbWluIGxlbmd0aC4gb25seSBjaGVja3Mgc3RyaW5ncywgZG9lc250IG1ha2Ugc2Vuc2VcblxuICAgIGlmIChcbiAgICAgIHZhbGlkYXRlSW5wdXQubWluTGVuZ3RoICE9IG51bGwgJiZcbiAgICAgIHR5cGVvZiB2YWxpZGF0ZUlucHV0LnZhbHVlID09PSBcInN0cmluZ1wiXG4gICAgKVxuICAgICAgaXNWYWxpZCA9XG4gICAgICAgIGlzVmFsaWQgJiYgdmFsaWRhdGVJbnB1dC52YWx1ZS5sZW5ndGggPiB2YWxpZGF0ZUlucHV0Lm1pbkxlbmd0aCE7IC8vIGlmIG1heExlbmd0aCBpcyBzZXQsIHRoZW4gaXQgc2hvdWxkIGhhdmUgYSBtYXggbGVuZ3RoLlxuXG4gICAgaWYgKFxuICAgICAgdmFsaWRhdGVJbnB1dC5tYXhMZW5ndGggIT0gbnVsbCAmJlxuICAgICAgdHlwZW9mIHZhbGlkYXRlSW5wdXQudmFsdWUgPT09IFwic3RyaW5nXCJcbiAgICApXG4gICAgICBpc1ZhbGlkID1cbiAgICAgICAgaXNWYWxpZCAmJiB2YWxpZGF0ZUlucHV0LnZhbHVlLmxlbmd0aCA8IHZhbGlkYXRlSW5wdXQubWF4TGVuZ3RoITsgLy90aGUgZm9sbG93aW5nIGNoZWNrcyBpZiB0aGUgaW5wdXQgaXMgYmlnZ2VyIHRoYW4gdGhlIG1pbiB2YWx1ZVxuXG4gICAgaWYgKHZhbGlkYXRlSW5wdXQubWluICE9IG51bGwgJiYgdHlwZW9mIHZhbGlkYXRlSW5wdXQudmFsdWUgPT09IFwibnVtYmVyXCIpXG4gICAgICBpc1ZhbGlkID0gaXNWYWxpZCAmJiB2YWxpZGF0ZUlucHV0LnZhbHVlID4gdmFsaWRhdGVJbnB1dC5taW47XG5cbiAgICAvL3RoZSBmb2xsb3dpbmcgY2hlY2tzIGlmIHRoZSBpbnB1dCBpcyBzbWFsbGVyIHRoYW4gdGhlIG1heCB2YWx1ZVxuICAgIGlmICh2YWxpZGF0ZUlucHV0Lm1heCAhPSBudWxsICYmIHR5cGVvZiB2YWxpZGF0ZUlucHV0LnZhbHVlID09PSBcIm51bWJlclwiKVxuICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGVJbnB1dC52YWx1ZSA8IHZhbGlkYXRlSW5wdXQubWF4O1xuXG4gICAgcmV0dXJuIGlzVmFsaWQ7XG4gIH1cbn1cbiIsIi8vYXV0b2JpbmQgZGVjb3JhdG9yLCB0aGlzIHdpbGwgZW5hYmxlIHRoZSBtZXRob2RzIHRvIGF1dG9tYXRpY2FsbHkgYmluZCB0byB1c2luZyAndGhpcycgaW5zdGVhZCBvZlxuLy9oYXZpbmcgdG8gZG8gLmJpbmQodGhpcykgZXZlcnkgdGltZVxuZXhwb3J0IGZ1bmN0aW9uIGF1dG9iaW5kKFxuICBfdGFyZ2V0OiBhbnksXG4gIF9tZXRob2ROYW1lOiBzdHJpbmcsXG4gIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvclxuKSB7XG4gIGNvbnN0IG9yaWdpbmFsTWV0aG9kID0gZGVzY3JpcHRvci52YWx1ZTtcbiAgY29uc3QgYWRqRGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yID0ge1xuICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICBnZXQoKSB7XG4gICAgICBjb25zdCBib3VuZEZ1bmN0aW9uID0gb3JpZ2luYWxNZXRob2QuYmluZCh0aGlzKTtcbiAgICAgIHJldHVybiBib3VuZEZ1bmN0aW9uO1xuICAgIH0sXG4gIH07XG4gIHJldHVybiBhZGpEZXNjcmlwdG9yO1xufVxuIiwiaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSBcIi4vQ29tcG9uZW50XCI7XG5pbXBvcnQgeyBhdXRvYmluZCB9IGZyb20gXCIuLi9kZWNvcmF0b3JzL2F1dG9iaW5kXCI7XG5pbXBvcnQgeyBQcm9qZWN0U3RhdGUgfSBmcm9tIFwiLi4vc3RhdGUvUHJvamVjdFN0YXRlXCI7XG5pbXBvcnQgeyBWYWxpdGFkYWJsZSB9IGZyb20gXCIuLi91dGlsL1ZhbGlkYXRhYmxlXCI7XG5cbi8vcHJvamVjdElucHV0IGNsYXNzXG5cbmV4cG9ydCBtb2R1bGUgUHJvamVjdElucHV0IHtcbiAgZXhwb3J0IGNsYXNzIFByb2plY3RJbnB1dCBleHRlbmRzIENvbXBvbmVudC5Db21wb25lbnQ8XG4gICAgSFRNTERpdkVsZW1lbnQsXG4gICAgSFRNTEZvcm1FbGVtZW50XG4gID4ge1xuICAgIHRpdGxlSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGRlc2NyaXB0aW9uSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuICAgIHBlb3BsZUlucHV0RWxlbWVudDogSFRNTElucHV0RWxlbWVudDtcblxuICAgIC8vY29uc3RydWN0b3IgdGhhdCBzZWxlY3RzIHRoZSBpdGVtcyBpbiB0aGUgSFRNTCBjb2RlIGFuZCBhdHRhY2hlcyB0byB0aGUgRE9NXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICBzdXBlcihcInByb2plY3QtaW5wdXRcIiwgXCJhcHBcIiwgdHJ1ZSwgXCJ1c2VyLWlucHV0XCIpO1xuXG4gICAgICAvL3NlbGVjdHMgaXRlbXMgaW4gdGhlIERPTVxuICAgICAgdGhpcy50aXRsZUlucHV0RWxlbWVudCA9IDxIVE1MSW5wdXRFbGVtZW50PihcbiAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjdGl0bGVcIilcbiAgICAgICk7XG4gICAgICB0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50ID0gPEhUTUxJbnB1dEVsZW1lbnQ+KFxuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZXNjcmlwdGlvblwiKVxuICAgICAgKTtcbiAgICAgIHRoaXMucGVvcGxlSW5wdXRFbGVtZW50ID0gPEhUTUxJbnB1dEVsZW1lbnQ+KFxuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcIiNwZW9wbGVcIilcbiAgICAgICk7XG5cbiAgICAgIC8vY2FsbHMgdGhlIGNvbmZpZ3VyZSBtZXRob2QgdGhhdCBhZGRzIGFuIGV2ZW50IGxpc3RlbmVyIHRvIHRoZSBmb3JtIHN1Ym1pc3Npb25cbiAgICAgIHRoaXMuY29uZmlndXJlKCk7XG4gICAgICB0aGlzLnJlbmRlckNvbnRlbnQoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdhdGhlclVzZXJJbnB1dCgpOiBbc3RyaW5nLCBzdHJpbmcsIG51bWJlcl0gfCB2b2lkIHtcbiAgICAgIGNvbnN0IGlucHV0VGl0bGUgPSB0aGlzLnRpdGxlSW5wdXRFbGVtZW50LnZhbHVlO1xuICAgICAgY29uc3QgaW5wdXREZXNjcmlwdGlvbiA9IHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQudmFsdWU7XG4gICAgICBjb25zdCBpbnB1dFBlb3BsZSA9IHRoaXMucGVvcGxlSW5wdXRFbGVtZW50LnZhbHVlO1xuXG4gICAgICAvL2NyZWF0ZSB0aGUgdmFsaWRhdGFibGUgb2JqZWN0c1xuICAgICAgY29uc3QgdGl0bGVWYWxpZGF0YWJsZTogVmFsaXRhZGFibGUuVmFsaWRhdGFibGUgPSB7XG4gICAgICAgIHZhbHVlOiBpbnB1dFRpdGxlLFxuICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGRlc2NyaXB0aW9uVmFsaWRhdGFibGU6IFZhbGl0YWRhYmxlLlZhbGlkYXRhYmxlID0ge1xuICAgICAgICB2YWx1ZTogaW5wdXREZXNjcmlwdGlvbixcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgIG1pbkxlbmd0aDogNSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHBlb3BsZVZhbGlkYXRhYmxlOiBWYWxpdGFkYWJsZS5WYWxpZGF0YWJsZSA9IHtcbiAgICAgICAgdmFsdWU6IGlucHV0VGl0bGUsXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICBtaW46IDEsXG4gICAgICAgIG1heDogNSxcbiAgICAgIH07XG5cbiAgICAgIGlmIChcbiAgICAgICAgIVZhbGl0YWRhYmxlLlZhbGlkYXRlKHRpdGxlVmFsaWRhdGFibGUpIHx8XG4gICAgICAgICFWYWxpdGFkYWJsZS5WYWxpZGF0ZShkZXNjcmlwdGlvblZhbGlkYXRhYmxlKSB8fFxuICAgICAgICAhVmFsaXRhZGFibGUuVmFsaWRhdGUocGVvcGxlVmFsaWRhdGFibGUpXG4gICAgICApXG4gICAgICAgIGFsZXJ0KFwiSW5wdXQgaXMgaW5jb3JyZWN0ISBUcnkgYWdhaW5cIik7XG4gICAgICBlbHNlIHJldHVybiBbaW5wdXRUaXRsZSwgaW5wdXREZXNjcmlwdGlvbiwgK2lucHV0UGVvcGxlXTtcbiAgICB9XG4gICAgLy9yZXNldHMgdGhlIGlucHV0IGZpZWxkcyBiYWNrIHRvIGVtcHR5IHN0cmluZ3NcbiAgICBwcml2YXRlIGNsZWFyaW5nRmllbGRzKCkge1xuICAgICAgdGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZSA9IFwiXCI7XG4gICAgICB0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50LnZhbHVlID0gXCJcIjtcbiAgICAgIHRoaXMucGVvcGxlSW5wdXRFbGVtZW50LnZhbHVlID0gXCJcIjtcbiAgICB9XG5cbiAgICBAYXV0b2JpbmRcbiAgICBwcml2YXRlIHN1Ym1pdEhhbmRsZXIoZXZlbnQ6IEV2ZW50KSB7XG4gICAgICAvL3ByZXZlbnQgdGhlIGRlZmF1bHQgSFRUUCByZXF1ZXN0IGJlIHNlbnQgb3V0XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgLy8gY29uc29sZS5sb2codGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZSk7XG4gICAgICBjb25zdCB1c2VySW5wdXQgPSB0aGlzLmdhdGhlclVzZXJJbnB1dCgpO1xuXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh1c2VySW5wdXQpKSB7XG4gICAgICAgIGNvbnN0IFt0aXRsZSwgZGVzY3JpcHRpb24sIG51bWJlcl0gPSB1c2VySW5wdXQ7XG4gICAgICAgIFByb2plY3RTdGF0ZS5wcm9qZWN0U3RhdGUuYWRkUHJvamVjdCh0aXRsZSwgZGVzY3JpcHRpb24sIG51bWJlcik7XG4gICAgICAgIHRoaXMuY2xlYXJpbmdGaWVsZHMoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvL2FkZHMgYW4gZXZlbnQgbGlzdGVuZXIgdG8gdGhlIGZvcm0gc3VibWlzc2lvblxuICAgIHB1YmxpYyBjb25maWd1cmUoKSB7XG4gICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLnN1Ym1pdEhhbmRsZXIpO1xuICAgIH1cbiAgICBwdWJsaWMgcmVuZGVyQ29udGVudCgpIHt9XG4gIH1cbn1cbiIsImltcG9ydCB7IGF1dG9iaW5kIH0gZnJvbSBcIi4uL2RlY29yYXRvcnMvYXV0b2JpbmRcIjtcbmltcG9ydCB7IFByb2plY3QgfSBmcm9tIFwiLi9Qcm9qZWN0XCI7XG5pbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tIFwiLi9Db21wb25lbnRcIjtcblxuZXhwb3J0IG1vZHVsZSBQcm9qZWN0SXRlbSB7XG4gIC8vUHJvamVjdEl0ZW0gY2xhc3MgaXMgcmVzcG9uc2libGUgZm9yIHJlbmRlcmluZyBvbmUgcHJvamVjdCBpdGVtIG9uIHRoZSBzY3JlZW5cbiAgZXhwb3J0IGNsYXNzIFByb2plY3RJdGVtXG4gICAgZXh0ZW5kcyBDb21wb25lbnQuQ29tcG9uZW50PEhUTUxVTGlzdEVsZW1lbnQsIEhUTUxMSUVsZW1lbnQ+XG4gICAgaW1wbGVtZW50cyBEcmFnZ2FibGUge1xuICAgIHByaXZhdGUgcHJvamVjdDogUHJvamVjdC5Qcm9qZWN0O1xuXG4gICAgLy9nZXR0ZXJcbiAgICBnZXQgcGVyc29ucygpIHtcbiAgICAgIGNvbnN0IHBlb3BsZSA9XG4gICAgICAgIHRoaXMucHJvamVjdC5wZW9wbGUgPT09IDFcbiAgICAgICAgICA/IFwiMSBQZXJzb25cIlxuICAgICAgICAgIDogYCR7dGhpcy5wcm9qZWN0LnBlb3BsZX0gUGVvcGxlYDtcbiAgICAgIHJldHVybiBwZW9wbGU7XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IoaG9zdElkOiBzdHJpbmcsIHByb2plY3Q6IFByb2plY3QuUHJvamVjdCkge1xuICAgICAgc3VwZXIoXCJzaW5nbGUtcHJvamVjdFwiLCBob3N0SWQsIGZhbHNlLCBwcm9qZWN0LmlkKTtcbiAgICAgIHRoaXMucHJvamVjdCA9IHByb2plY3Q7XG4gICAgICB0aGlzLmNvbmZpZ3VyZSgpO1xuICAgICAgdGhpcy5yZW5kZXJDb250ZW50KCk7XG4gICAgfVxuICAgIEBhdXRvYmluZFxuICAgIGRyYWdTdGFydEhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCkge1xuICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyIS5zZXREYXRhKFwidGV4dC9wbGFpblwiLCB0aGlzLnByb2plY3QuaWQpO1xuICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyIS5lZmZlY3RBbGxvd2VkID0gXCJtb3ZlXCI7XG4gICAgfVxuXG4gICAgZHJhZ0VuZEhhbmRsZXIoX2V2ZW50OiBEcmFnRXZlbnQpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiZHJhZyBldmVudCBlbmRlZFwiKTtcbiAgICB9XG5cbiAgICBjb25maWd1cmUoKSB7XG4gICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdzdGFydFwiLCB0aGlzLmRyYWdTdGFydEhhbmRsZXIpO1xuICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnZW5kXCIsIHRoaXMuZHJhZ0VuZEhhbmRsZXIpO1xuICAgIH1cblxuICAgIHJlbmRlckNvbnRlbnQoKSB7XG4gICAgICAvL3JlYWNoZXMgb3V0IHRvIERPTSBlbGVtZW50cyB0byByZW5kZXJcbiAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiaDJcIikhLnRleHRDb250ZW50ID0gdGhpcy5wcm9qZWN0LnRpdGxlO1xuICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJoM1wiKSEudGV4dENvbnRlbnQgPVxuICAgICAgICB0aGlzLnBlcnNvbnMgKyBcIiBhc3NpZ25lZFwiO1xuICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJwXCIpIS50ZXh0Q29udGVudCA9XG4gICAgICAgIFwiUHJvamVjdCBkZXNjcmlwdGlvbjogXCIgKyB0aGlzLnByb2plY3QuZGVzY3JpcHRpb247XG4gICAgfVxuICB9XG59XG4iLCJpbXBvcnQgeyBhdXRvYmluZCB9IGZyb20gXCIuLi9kZWNvcmF0b3JzL2F1dG9iaW5kXCI7XG5pbXBvcnQgeyBQcm9qZWN0IH0gZnJvbSBcIi4vUHJvamVjdFwiO1xuaW1wb3J0IHsgUHJvamVjdEl0ZW0gfSBmcm9tIFwiLi9Qcm9qZWN0SXRlbVwiO1xuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSBcIi4vQ29tcG9uZW50XCI7XG5pbXBvcnQgeyBQcm9qZWN0U3RhdGUgfSBmcm9tIFwiLi4vc3RhdGUvUHJvamVjdFN0YXRlXCI7XG5cbmV4cG9ydCBtb2R1bGUgUHJvamVjdExpc3Qge1xuICAvL3Byb2plY3RMaXN0IENsYXNzXG4gIGV4cG9ydCBjbGFzcyBQcm9qZWN0TGlzdFxuICAgIGV4dGVuZHMgQ29tcG9uZW50LkNvbXBvbmVudDxIVE1MRGl2RWxlbWVudCwgSFRNTEVsZW1lbnQ+XG4gICAgaW1wbGVtZW50cyBEcmFnVGFyZ2V0IHtcbiAgICBhc3NpZ25lZFByb2plY3RzOiBQcm9qZWN0LlByb2plY3RbXTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdHlwZTogXCJhY3RpdmVcIiB8IFwiZmluaXNoZWRcIikge1xuICAgICAgc3VwZXIoXCJwcm9qZWN0LWxpc3RcIiwgXCJhcHBcIiwgZmFsc2UsIGAke3R5cGV9LXByb2plY3RzYCk7IC8vIHBhc3NlcyBhbGwgcmVsZXZhbnQgaW5mb3JtYXRpb24gdG8gc3VwZXJcbiAgICAgIHRoaXMuYXNzaWduZWRQcm9qZWN0cyA9IFtdO1xuICAgICAgdGhpcy5jb25maWd1cmUoKTsgLy8gc2V0IHVwIHRoZSBsaXN0ZW5lclxuICAgICAgdGhpcy5yZW5kZXJDb250ZW50KCk7XG4gICAgfVxuICAgIEBhdXRvYmluZFxuICAgIGRyYWdPdmVySGFuZGxlcihldmVudDogRHJhZ0V2ZW50KSB7XG4gICAgICBpZiAoZXZlbnQuZGF0YVRyYW5zZmVyICYmIGV2ZW50LmRhdGFUcmFuc2Zlci50eXBlc1swXSA9PT0gXCJ0ZXh0L3BsYWluXCIpIHtcbiAgICAgICAgLy8gYWxsb3dzIG9ubHkgdGV4dCB0cmFuc2ZlclxuICAgICAgICAvL2phdmFzY3JpcHQncyBkZWZhdWx0IGJlaGF2aW91ciBpcyB0byBub3QgYWxsb3cgZHJvcHBpbmcsIHlvdSBoYXZlIHRvIHByZXZlbnQgdGhhdFxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zdCBsaXN0RWwgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcInVsXCIpITtcbiAgICAgICAgbGlzdEVsLmNsYXNzTGlzdC5hZGQoXCJkcm9wcGFibGVcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy9hdXRvYmluZHMga2V5d29yZCB0aGlzIHRvIHRoZSBzdXJyb3VuZGluZyBjbGFzc1xuICAgIEBhdXRvYmluZFxuICAgIGRyb3BIYW5kbGVyKGV2ZW50OiBEcmFnRXZlbnQpIHtcbiAgICAgIGNvbnN0IHByb2pJZCA9IGV2ZW50LmRhdGFUcmFuc2ZlciEuZ2V0RGF0YShcInRleHQvcGxhaW5cIik7XG4gICAgICBQcm9qZWN0U3RhdGUucHJvamVjdFN0YXRlLm1vdmVQcm9qZWN0KFxuICAgICAgICBwcm9qSWQsXG4gICAgICAgIHRoaXMudHlwZSA9PT0gXCJhY3RpdmVcIlxuICAgICAgICAgID8gUHJvamVjdC5Qcm9qZWN0U3RhdHVzLmFjdGl2ZVxuICAgICAgICAgIDogUHJvamVjdC5Qcm9qZWN0U3RhdHVzLmZpbmlzaGVkXG4gICAgICApO1xuICAgIH1cblxuICAgIEBhdXRvYmluZFxuICAgIGRyYWdMZWF2ZUhhbmRsZXIoX2V2ZW50OiBEcmFnRXZlbnQpIHtcbiAgICAgIGNvbnN0IGxpc3RFbCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwidWxcIikhO1xuICAgICAgbGlzdEVsLmNsYXNzTGlzdC5yZW1vdmUoXCJkcm9wcGFibGVcIik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW5kZXJQcm9qZWN0cygpIHtcbiAgICAgIC8vcmVuZGVycyBhbGwgdGhlIHByb2plY3RzXG4gICAgICBjb25zdCBsaXN0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcbiAgICAgICAgYCR7dGhpcy50eXBlfS1wcm9qZWN0cy1saXN0YFxuICAgICAgKSEgYXMgSFRNTFVMaXN0RWxlbWVudDtcbiAgICAgIGxpc3RFbC5pbm5lckhUTUwgPSBcIlwiO1xuICAgICAgZm9yIChjb25zdCBwcmpJdGVtIG9mIHRoaXMuYXNzaWduZWRQcm9qZWN0cykge1xuICAgICAgICBuZXcgUHJvamVjdEl0ZW0uUHJvamVjdEl0ZW0oXG4gICAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJ1bFwiKSEuaWQsXG4gICAgICAgICAgcHJqSXRlbVxuICAgICAgICApOyAvL3Bhc3NlcyBvbmx5IG9uZSBwcm9qZWN0IGl0ZW0gYXQgYSB0aW1lXG4gICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHJlbmRlckNvbnRlbnQoKSB7XG4gICAgICAvL3JlbmRlcnMgdGhlIGxpc3Qgd2l0aG91dCBjb250ZW50XG4gICAgICBjb25zdCBsaXN0SWQgPSBgJHt0aGlzLnR5cGV9LXByb2plY3RzLWxpc3RgO1xuICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJ1bFwiKSEuaWQgPSBsaXN0SWQ7XG4gICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcImgyXCIpIS50ZXh0Q29udGVudCA9XG4gICAgICAgIHRoaXMudHlwZS50b1VwcGVyQ2FzZSgpICsgXCIgUFJPSkVDVFNcIjtcbiAgICB9XG5cbiAgICBjb25maWd1cmUoKSB7XG4gICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsIHRoaXMuZHJhZ092ZXJIYW5kbGVyKTtcbiAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ2xlYXZlXCIsIHRoaXMuZHJhZ0xlYXZlSGFuZGxlcik7XG4gICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgdGhpcy5kcm9wSGFuZGxlcik7XG4gICAgICAvLyBjb25maWd1cmUgdGhlIGxpc3RlbmVyXG4gICAgICBQcm9qZWN0U3RhdGUucHJvamVjdFN0YXRlLmFkZExpc3RlbmVyKChwcm9qZWN0czogUHJvamVjdC5Qcm9qZWN0W10pID0+IHtcbiAgICAgICAgLy9maWx0ZXJzIHRoZSBhY3RpdmUgcHJvamVjdHNcbiAgICAgICAgY29uc3QgZmlsdGVyZWRQcm9qZWN0cyA9IHByb2plY3RzLmZpbHRlcigocHJqKSA9PiB7XG4gICAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gXCJhY3RpdmVcIikge1xuICAgICAgICAgICAgcmV0dXJuIHByai5zdGF0dXMgPT09IFByb2plY3QuUHJvamVjdFN0YXR1cy5hY3RpdmU7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBwcmouc3RhdHVzID09PSBQcm9qZWN0LlByb2plY3RTdGF0dXMuZmluaXNoZWQ7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmFzc2lnbmVkUHJvamVjdHMgPSBmaWx0ZXJlZFByb2plY3RzO1xuICAgICAgICB0aGlzLnJlbmRlclByb2plY3RzKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn1cbiIsImltcG9ydCB7IFByb2plY3RJbnB1dCB9IGZyb20gXCIuL2NvbXBvbmVudHMvUHJvamVjdElucHV0XCI7XG5pbXBvcnQgeyBQcm9qZWN0TGlzdCB9IGZyb20gXCIuL2NvbXBvbmVudHMvUHJvamVjdExpc3RcIjtcblxuZXhwb3J0IG1vZHVsZSBBcHAge1xuICAvL2NyZWF0ZXMgYSB2YXJpYWJsZSBhbmQgaW5zdGFudGlhdGVzIGEgUHJvamVjdElucHV0IG9iamVjdFxuICBleHBvcnQgY29uc3QgcHJvaiA9IG5ldyBQcm9qZWN0SW5wdXQuUHJvamVjdElucHV0KCk7XG4gIC8vaW5zdGFudGlhdGVzIHRoZSBwcm9qZWN0IGxpc3RcbiAgZXhwb3J0IGNvbnN0IGFjdGl2ZVByb2pMaXN0ID0gbmV3IFByb2plY3RMaXN0LlByb2plY3RMaXN0KFwiYWN0aXZlXCIpO1xuICBleHBvcnQgY29uc3QgZmluaXNoZWRQcm9qTGlzdCA9IG5ldyBQcm9qZWN0TGlzdC5Qcm9qZWN0TGlzdChcImZpbmlzaGVkXCIpO1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==